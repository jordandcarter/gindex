<% content_for :head do %>Your Websites<% end %>
<h1>Listing websites</h1>

<div id="placeholder" style="height: 400px; width:600px"></div>
  <div>Google Index count as of <%= @websites.first.counts.last.created_at.strftime("%d %b, %A") %>
  <div>This is an approximation of whole many pages are of the website is contained in Google's index</div>
  <div class="round" style="width: 600px;">
<% @websites.each_with_index do |website, i| %>
<div class="listing<%= " highlighted" if i % 2 == 1%>">
    <div class="url"><%= link_to h(website.url), website %></div>
    <div class="count"><%=h website.counts.last.nil? ? "na" : website.counts.last.count %></div>
    <div class='clear'><!-- / --> </div>
  </div>
<% end %>
</div>
<script type="text/javascript">
$(document).ready(function(){
  $.plot($("#placeholder"), [
  <% @websites.each_with_index do |website, i| %>
    { label: "<%= website.url %>", data: [ <%=website.counts.from_date(1.month.ago).collect{|count| "[#{count.created_at.to_i*1000}, #{count.count}]"}.join(",") %>]} <%= "," unless i == @websites.size%>
  <% end %>
  ], {xaxis:{mode: "time"}} );
});
</script>
